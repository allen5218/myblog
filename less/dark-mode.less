// Dark Mode Variables and Styles

// Light theme variables (default)
:root {
  color-scheme: light;
  --bg-color: #ffffff;
  --text-color: #404040;
  --text-muted: #a3a3a3;
  --nav-bg: transparent;
  --nav-text: #ffffff;
  --nav-text-hover: rgba(255, 255, 255, 0.8);
  --nav-invert-bg: transparent;
  --nav-invert-text: #404040;
  --nav-invert-text-hover: #0085a1;
  --search-bg: #ffffff;
  --search-text: #404040;
  --search-icon: #311e3e;
  --post-bg: #ffffff;
  --post-text: #404040;
  --post-link: #337ab7;
  --post-link-hover: #0085a1;
  --border-color: #ececec;
  --table-border: #eee;
  --blockquote-color: #404040;
  --blockquote-bg: #f8f8f8;
  --tag-bg: #f3f5f5;
  --tag-text: #404040;
  --tag-hover-bg: #0085a1;
  --back-top-bg: rgba(255, 255, 255, 0.7);
  --back-top-border: #bfbfbf;
  --back-top-text: #bfbfbf;
  --back-top-hover-bg: #0085a1;
  --back-top-hover-border: #0085a1;
  --back-top-hover-text: #ffffff;
  --disqus-bg: #ffffff;
  --disqus-text: #404040;
  --catalog-active-bg: #f5f5f5;
  --catalog-active-link: #0085a1;
}

// Dark theme variables
[data-theme="dark"] {
  color-scheme: dark;
  --bg-color: #2d2d2d;
  --text-color: #e0e0e0;
  --text-muted: #888888;
  --nav-bg: transparent;
  --nav-text: #e0e0e0;
  --nav-text-hover: rgba(224, 224, 224, 0.8);
  --nav-invert-bg: transparent;
  --nav-invert-text: #e0e0e0;
  --nav-invert-text-hover: #4db8d1;
  --search-bg: #2d2d2d;
  --search-text: #e0e0e0;
  --search-icon: #e0e0e0;
  --post-bg: #2d2d2d;
  --post-text: #e0e0e0;
  --post-link: #4db8d1;
  --post-link-hover: #66c7e0;
  --border-color: #333333;
  --table-border: #333333;
  --blockquote-color: #e0e0e0;
  --blockquote-bg: #3a3a3a;
  --tag-bg: #333333;
  --tag-text: #e0e0e0;
  --tag-hover-bg: #4db8d1;
  --back-top-bg: rgba(45, 45, 45, 0.9);
  --back-top-border: #555555;
  --back-top-text: #e0e0e0;
  --back-top-hover-bg: #4db8d1;
  --back-top-hover-border: #4db8d1;
  --back-top-hover-text: #ffffff;
  --disqus-bg: #2d2d2d;
  --disqus-text: #e0e0e0;
  --catalog-active-bg: #3a3a3a;
  --catalog-active-link: #66c7e0;
}

// Theme toggle button styles - optimized for smooth transitions
.theme-toggle {
  position: relative;
  display: inline-block;
  will-change: auto; // Avoid unnecessary layer creation
  
  .theme-text {
    transition: opacity 0.3s ease, transform 0.3s ease;
    will-change: opacity, transform;
    backface-visibility: hidden; // Force hardware acceleration
    transform: translateZ(0); // Create compositing layer
  }
  
  // Desktop: dark-text relative positioning, light-text absolute positioning
  @media only screen and (min-width: 768px) {
    padding: 20px; // Match other navbar links
    line-height: 20px;
    white-space: nowrap;
    
    .dark-text {
      // Relative positioning - displays normally in navbar
      position: relative;
      display: inline;
    }
    
    .light-text {
      // Absolute positioning - overlays on top of dark-text
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      padding: 20px; // Match container padding
      line-height: 20px;
      text-align: right; // Right align so T aligns with K of DARK
    }
  }
  
  // Light mode: show LIGHT text, hide DARK text
  .light-text {
    opacity: 1;
  }
  
  .dark-text {
    opacity: 0;
  }
  
  // Mobile specific fixes
  @media only screen and (max-width: 767px) {
    width: auto;
    min-width: 0;
    overflow: visible;
    
    .theme-text {
      white-space: nowrap;
    }
    
    .dark-text {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
  }
}

// Desktop: Create positioning context for theme toggle button
@media only screen and (min-width: 768px) {
  .theme-toggle-li {
    // Create positioning context for absolute positioned light-text
    position: relative;
    // Remove width: 0 since dark-text now displays normally in navbar
    overflow: visible; // Allow absolutely positioned light-text to show
  }
}

// Dark mode: show DARK text, hide LIGHT text - pure opacity transition
[data-theme="dark"] .theme-toggle {
  .light-text {
    opacity: 0;
  }
  
  .dark-text {
    opacity: 1;
  }
  
  // Mobile specific fixes for dark mode
  @media only screen and (max-width: 767px) {
    .light-text {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
    
    .dark-text {
      position: static;
      width: auto;
    }
  }
}

// Apply dark mode styles to main elements
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background-color 0.3s ease, color 0.3s ease;
  overflow-x: hidden; // Preserve original overflow setting
}

// Exclude navbar from theme changes when navbar-theme-excluded class is present
body.navbar-theme-excluded {
  .navbar-custom {
    .navbar-brand {
      color: white !important;
      &:hover,
      &:focus {
        color: rgba(255, 255, 255, 0.8) !important;
      }
    }
    
    .nav li a {
      color: white !important;
      &:hover,
      &:focus {
        color: rgba(255, 255, 255, 0.8) !important;
      }
    }
    
    &.invert {
      .navbar-brand {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
      
      .nav li a {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
    }
  }
}

// Navigation styles for dark mode
.navbar-custom {
  .navbar-brand {
    color: var(--nav-text) !important;
    &:hover,
    &:focus {
      color: var(--nav-text-hover) !important;
    }
  }
  
  .nav li a {
    color: var(--nav-text) !important;
    &:hover,
    &:focus {
      color: var(--nav-text-hover) !important;
    }
  }
  
  &.invert {
    .navbar-brand {
      color: var(--nav-invert-text) !important;
      &:hover,
      &:focus {
        color: var(--nav-invert-text-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--nav-invert-text) !important;
      &:hover,
      &:focus {
        color: var(--nav-invert-text-hover) !important;
      }
    }
    
    .navbar-toggle .icon-bar {
      background-color: var(--nav-invert-text) !important;
    }
  }
  
  // Fixed navbar semi-transparent background
  &.is-fixed {
    background-color: fade(#ffffff, 90%) !important; // Light mode: 90% white
    border-bottom: 1px solid darken(#ffffff, 5%) !important;
    
    .navbar-brand {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

// Dark mode navbar fixed background override
[data-theme="dark"] .navbar-custom {
  &.is-fixed {
    background-color: fade(#2d2d2d, 90%) !important; // Dark mode: 90% dark background
    border-bottom: 1px solid lighten(#2d2d2d, 15%) !important; // Lighter border for dark mode
    
    .navbar-brand {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

// Search page dark mode
.search-page {
  background: var(--search-bg) !important;
  
  #search-input {
    color: var(--search-text) !important;
    background: var(--search-bg) !important;
  }
  
  .search-icon-close {
    color: var(--search-icon) !important;
  }
}

.search-icon a {
  color: var(--search-icon) !important;
}

// Post content dark mode
.post-container {
  background-color: var(--post-bg);
  color: var(--post-text);
  
  a {
    color: var(--post-link) !important;
    &:hover,
    &:focus {
      color: var(--post-link-hover) !important;
    }
  }
  
  h2::before {
    border-bottom-color: #ffffff !important;
  }
  
  h4, h5, h6 {
    color: var(--text-muted) !important;
  }
}

// Main content areas
a {
  color: var(--text-color) !important;
  &:hover,
  &:focus {
    color: var(--post-link-hover) !important;
  }
}

// Blockquotes
blockquote {
  color: var(--blockquote-color) !important;
  background-color: var(--blockquote-bg) !important;
  padding: 15px 20px !important;
  border-radius: 5px !important;
  margin: 20px 0 !important;
}

// Tables
table.table > tbody,
table.table > thead {
  th, td {
    border-color: var(--table-border) !important;
  }
}

// Tags
#tag_cloud {
  a, .tag {
    background: var(--tag-bg) !important;
    color: var(--tag-text) !important;
    
    &:hover,
    &:active,
    &.focus {
      background-color: var(--tag-hover-bg) !important;
      color: #ffffff !important;
    }
  }
}

// Back to top button - Light mode: dark border, Dark mode: inverted
#back-top a {
  background-color: var(--back-top-bg) !important;
  border-color: var(--back-top-border) !important;
  color: var(--back-top-text) !important;
  transition: all 0.3s ease;
  
  &:hover,
  &:focus {
    background-color: var(--back-top-hover-bg) !important;
    border-color: var(--back-top-hover-border) !important;
    color: var(--back-top-hover-text) !important;
  }
}

#back-top a:hover i,
#back-top a:focus i {
  color: var(--back-top-hover-text) !important;
}

// Disqus dark mode support
#disqus_thread {
  background-color: var(--disqus-bg) !important;
  color: var(--disqus-text) !important;
}

// Post preview styles
.post-preview {
  > a {
    color: var(--text-color) !important;
    &:hover,
    &:focus {
      color: var(--post-link-hover) !important;
    }
  }
  
  > .post-meta {
    color: var(--text-muted) !important;
    > a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

.post-content-preview {
  color: var(--text-muted) !important;
  &:hover {
    color: var(--post-link-hover) !important;
  }
}

// Footer
footer .copyright a {
  color: var(--post-link) !important;
  &:hover,
  &:focus {
    color: var(--post-link-hover) !important;
  }
}

// Mobile navbar and layout fixes
@media only screen and (max-width: 767px) {
  
  .navbar-default .navbar-collapse {
    background: var(--bg-color) !important;
    border: 1px solid var(--border-color) !important;
  }
  
  // Fix mobile navbar colors for light mode
  .navbar-custom {
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    // Override invert class on mobile for light mode
    &.invert {
      .nav li a {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
    }
  }
  
  // Ensure theme toggle doesn't cause horizontal scroll
  .theme-toggle-li {
    overflow: hidden;
    
    .theme-toggle {
      max-width: 100%;
      overflow: hidden;
    }
  }
}

// Side catalog
.side-catalog {
  background-color: var(--bg-color);
  color: var(--text-color);
  
  h5 a {
    color: var(--text-color) !important;
    &:hover {
      color: var(--post-link-hover) !important;
    }
  }
  
  .catalog-body {
    li a {
      color: var(--text-color) !important;
      &:hover {
        color: var(--post-link-hover) !important;
      }
    }
    
    .active {
      background-color: var(--catalog-active-bg) !important;
      
      a {
        color: var(--catalog-active-link) !important;
      }
    }
  }
}


// Pager (Previous/Next buttons) dark mode
.pager {
  li {
    > a,
    > span {
      background-color: var(--post-bg) !important;
      color: var(--text-color) !important;
    }
    
    > a:hover,
    > a:focus {
      background-color: var(--post-link-hover) !important;
      border-color: var(--post-link-hover) !important;
      color: #ffffff !important;
      
      > span {
        color: #ffffff !important;
      }
    }
  }
  
  .disabled {
    > a,
    > a:hover,
    > a:focus,
    > span {
      background-color: var(--tag-bg) !important;
      color: var(--text-muted) !important;
    }
  }
}

// For pages with header-img (background image), keep tags white in both light and dark modes
// This is controlled by the navbar-theme-excluded class added by dark-mode.js
body.navbar-theme-excluded {
  .intro-header {
    .tags {
      a, .tag {
        border-color: rgba(255, 255, 255, 0.8) !important;
        color: rgba(255, 255, 255, 1) !important;
        &:hover,
        &:active {
          color: white !important;
          border-color: white !important;
          background-color: rgba(255, 255, 255, 0.4) !important;
        }
      }
    }
  }
}

// Dark mode styles for footer and sidebar font awesome icons
[data-theme="dark"] {
  // Footer social media icons
  footer .fa-stack {
    .fa-circle {
      color: white !important;
    }
    
    .fa-inverse {
      color: #404040 !important;
    }
  }
  
  // Sidebar ABOUT ME section social media icons
  .sidebar-container .short-about .fa-stack {
    .fa-circle {
      color: white !important;
    }
    
    .fa-inverse {
      color: #404040 !important;
    }
  }
}

// Dark mode code highlighting - Light background with dark text for better readability
[data-theme="dark"] {
  // Override code block background to light gray
  .highlight,
  pre.highlight {
    background: #f0f0f0 !important;
  }
  
  .highlight pre {
    background: #f0f0f0 !important;
  }
  
  .highlight .hll {
    background: #f0f0f0 !important;
  }
  
  // Basic text colors - change from light to dark
  .highlight .c {
    color: #6c757d !important; // Comments: medium gray for good readability
  }
  
  .highlight .err {
    color: #dc3545 !important; // Errors: red
    background-color: #f8d7da !important; // Light red background
  }
  
  // Keep Coq language error styling
  .language-coq .highlight .err {
    background-color: transparent !important;
  }
  
  // Keywords - make purple darker for better visibility
  .highlight .k {
    color: #8e44ad !important; // Keywords: darker purple (was #c678dd)
  }
  
  .highlight .kc {
    color: #8e44ad !important; // Keyword constant: darker purple
  }
  
  .highlight .kd {
    color: #8e44ad !important; // Keyword declaration: darker purple  
  }
  
  .highlight .kn {
    color: #8e44ad !important; // Keyword namespace: darker purple
  }
  
  .highlight .kp {
    color: #8e44ad !important; // Keyword pseudo: darker purple
  }
  
  .highlight .kr {
    color: #8e44ad !important; // Keyword reserved: darker purple
  }
  
  .highlight .kt {
    color: #8e44ad !important; // Keyword type: darker purple
  }
  
  // Strings - make green darker for better contrast
  .highlight .s {
    color: #27ae60 !important; // Strings: darker green (was #98c379)
  }
  
  .highlight .ld {
    color: #27ae60 !important; // Literal date: darker green
  }
  
  .highlight .sb {
    color: #27ae60 !important; // String backtick: darker green
  }
  
  .highlight .sc {
    color: #27ae60 !important; // String char: darker green
  }
  
  .highlight .sd {
    color: #27ae60 !important; // String doc: darker green
  }
  
  .highlight .s2 {
    color: #27ae60 !important; // String double: darker green
  }
  
  .highlight .se {
    color: #27ae60 !important; // String escape: darker green
  }
  
  .highlight .sh {
    color: #27ae60 !important; // String heredoc: darker green
  }
  
  .highlight .si {
    color: #27ae60 !important; // String interpol: darker green
  }
  
  .highlight .sx {
    color: #27ae60 !important; // String other: darker green
  }
  
  .highlight .s1 {
    color: #27ae60 !important; // String single: darker green
  }
  
  // Numbers - make orange darker
  .highlight .m {
    color: #d35400 !important; // Number: darker orange (was #d19a66)
  }
  
  .highlight .mf {
    color: #d35400 !important; // Number float: darker orange
  }
  
  .highlight .mh {
    color: #d35400 !important; // Number hex: darker orange
  }
  
  .highlight .mi {
    color: #d35400 !important; // Number integer: darker orange
  }
  
  .highlight .mo {
    color: #d35400 !important; // Number octal: darker orange
  }
  
  .highlight .il {
    color: #d35400 !important; // Number integer long: darker orange
  }
  
  // Attributes - make orange darker
  .highlight .na {
    color: #d35400 !important; // Name attribute: darker orange
  }
  
  // Blue elements - make darker for better contrast
  .highlight .sr {
    color: #2980b9 !important; // String regex: darker blue (was #56b6c2)
  }
  
  .highlight .ss {
    color: #2980b9 !important; // String symbol: darker blue
  }
  
  // Basic syntax elements - adjust light colors to dark
  .highlight .n {
    color: #2c3e50 !important; // Names: dark blue-gray
  }
  
  .highlight .o {
    color: #2c3e50 !important; // Operators: dark blue-gray
  }
  
  .highlight .p {
    color: #2c3e50 !important; // Punctuation: dark blue-gray
  }
  
  // Comments - all comment types
  .highlight .cm {
    color: #6c757d !important; // Multi-line comments
  }
  
  .highlight .cp {
    color: #6c757d !important; // Preprocessor comments
  }
  
  .highlight .c1 {
    color: #6c757d !important; // Single line comments
  }
  
  .highlight .cs {
    color: #6c757d !important; // Special comments
  }
  
  // Function names and identifiers
  .highlight .nf {
    color: #2c3e50 !important; // Function names: dark blue-gray
  }
  
  .highlight .nl {
    color: #e67e22 !important; // Labels: orange (darker than original)
  }
  
  .highlight .nn {
    color: #2c3e50 !important; // Namespaces: dark blue-gray
  }
  
  .highlight .nx {
    color: #2c3e50 !important; // Other names: dark blue-gray
  }
  
  .highlight .py {
    color: #e67e22 !important; // Property: orange (darker)
  }
  
  .highlight .nv {
    color: #e67e22 !important; // Variables: orange (darker)
  }
  
  // Whitespace - change from near-white to dark
  .highlight .w {
    color: #2c3e50 !important; // Whitespace: dark blue-gray
  }
  
  // Built-in names and classes - make yellow darker for better contrast
  .highlight .nb {
    color: #d68910 !important; // Name builtin: darker yellow (was #e5c07b)
  }
  
  .highlight .nc {
    color: #d68910 !important; // Name class: darker yellow
  }
  
  .highlight .no {
    color: #d68910 !important; // Name constant: darker yellow
  }
  
  .highlight .nd {
    color: #d68910 !important; // Name decorator: darker yellow
  }
  
  .highlight .ni {
    color: #d68910 !important; // Name entity: darker yellow
  }
  
  .highlight .ne {
    color: #d68910 !important; // Name exception: darker yellow
  }
  
  .highlight .py {
    color: #d68910 !important; // Name property: darker yellow (overriding previous orange)
  }
  
  .highlight .nv {
    color: #d68910 !important; // Name variable: darker yellow (overriding previous orange)
  }
  
  // HTML/XML tags - make red darker
  .highlight .nt {
    color: #c0392b !important; // Name tag: darker red (was #e06c75)
  }
  
  .highlight .vi {
    color: #c0392b !important; // Variable instance: darker red (was #e06c75)
  }
  
  // Variable types
  .highlight .bp {
    color: #d68910 !important; // Builtin pseudo: darker yellow (was orange)
  }
  
  .highlight .vc {
    color: #d68910 !important; // Variable class: darker yellow (was orange)
  }
  
  .highlight .vg {
    color: #d68910 !important; // Variable global: darker yellow (was orange)
  }
  
  // Diff colors - adjust for better contrast
  .highlight .gu {
    color: #495057 !important; // Diff unified: darker gray
  }
  
  // Table styling for code blocks
  .highlighter-rouge .highlight {
    .rouge-code {
      pre {
        color: #2c3e50 !important; // Default color for code without specific highlighting
      }
    }
  }
  
  // Ensure proper styling for mobile
  @media (max-width: 480px) {
    .highlighter-rouge .highlight {
      background: #f0f0f0 !important;
      
      table > tbody > tr > td > pre {
        background: #f0f0f0 !important;
      }
    }
  }
}