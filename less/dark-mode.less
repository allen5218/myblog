// Dark Mode Variables and Styles

// Light theme variables (default)
:root {
  --bg-color: #ffffff;
  --text-color: #404040;
  --text-muted: #a3a3a3;
  --nav-bg: transparent;
  --nav-text: #ffffff;
  --nav-text-hover: rgba(255, 255, 255, 0.8);
  --nav-invert-bg: transparent;
  --nav-invert-text: #404040;
  --nav-invert-text-hover: #0085a1;
  --search-bg: #ffffff;
  --search-text: #404040;
  --search-icon: #311e3e;
  --post-bg: #ffffff;
  --post-text: #404040;
  --post-link: #337ab7;
  --post-link-hover: #0085a1;
  --border-color: #ececec;
  --table-border: #eee;
  --blockquote-color: gray;
  --tag-bg: #f3f5f5;
  --tag-text: #404040;
  --tag-hover-bg: #0085a1;
  --back-top-bg: rgba(255, 255, 255, 0.7);
  --back-top-border: #bfbfbf;
  --back-top-text: #bfbfbf;
  --back-top-hover-bg: #0085a1;
  --back-top-hover-border: #0085a1;
  --back-top-hover-text: #ffffff;
  --disqus-bg: #ffffff;
  --disqus-text: #404040;
}

// Dark theme variables
[data-theme="dark"] {
  --bg-color: #2d2d2d;
  --text-color: #e0e0e0;
  --text-muted: #888888;
  --nav-bg: transparent;
  --nav-text: #e0e0e0;
  --nav-text-hover: rgba(224, 224, 224, 0.8);
  --nav-invert-bg: transparent;
  --nav-invert-text: #e0e0e0;
  --nav-invert-text-hover: #4db8d1;
  --search-bg: #2d2d2d;
  --search-text: #e0e0e0;
  --search-icon: #e0e0e0;
  --post-bg: #2d2d2d;
  --post-text: #e0e0e0;
  --post-link: #4db8d1;
  --post-link-hover: #66c7e0;
  --border-color: #333333;
  --table-border: #333333;
  --blockquote-color: #888888;
  --tag-bg: #333333;
  --tag-text: #e0e0e0;
  --tag-hover-bg: #4db8d1;
  --back-top-bg: rgba(45, 45, 45, 0.9);
  --back-top-border: #555555;
  --back-top-text: #e0e0e0;
  --back-top-hover-bg: #4db8d1;
  --back-top-hover-border: #4db8d1;
  --back-top-hover-text: #ffffff;
  --disqus-bg: #2d2d2d;
  --disqus-text: #e0e0e0;
}

// Theme toggle button styles - optimized for smooth transitions
.theme-toggle {
  // Need relative positioning for absolute positioned text
  position: relative;
  display: inline-block;
  will-change: auto; // Avoid unnecessary layer creation
  
  .theme-text {
    transition: opacity 0.3s ease, transform 0.3s ease;
    will-change: opacity, transform;
    backface-visibility: hidden; // Force hardware acceleration
    transform: translateZ(0); // Create compositing layer
  }
  
  // Desktop: precise positioning to mimic navbar-nav li a alignment
  @media only screen and (min-width: 768px) {
    // Match navbar-custom .nav li a padding and line-height for perfect alignment
    padding: 20px;
    line-height: 20px;
    
    .theme-text {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      // Inherit the same padding and line-height as parent
      padding: 20px;
      line-height: 20px;
      text-align: left; // Ensure consistent text alignment
    }
  }
  
  // Light mode: show LIGHT text, hide DARK text
  .light-text {
    opacity: 1;
  }
  
  .dark-text {
    opacity: 0;
  }
  
  // Mobile specific fixes
  @media only screen and (max-width: 767px) {
    width: auto;
    min-width: 0;
    overflow: visible;
    
    .theme-text {
      white-space: nowrap;
    }
    
    .dark-text {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
  }
}

// Dark mode: show DARK text, hide LIGHT text - pure opacity transition
[data-theme="dark"] .theme-toggle {
  .light-text {
    opacity: 0;
  }
  
  .dark-text {
    opacity: 1;
  }
  
  // Mobile specific fixes for dark mode
  @media only screen and (max-width: 767px) {
    .light-text {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
    
    .dark-text {
      position: static;
      width: auto;
    }
  }
}

// Apply dark mode styles to main elements
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background-color 0.3s ease, color 0.3s ease;
  overflow-x: hidden; // Preserve original overflow setting
}

// Exclude navbar from theme changes when navbar-theme-excluded class is present
body.navbar-theme-excluded {
  .navbar-custom {
    .navbar-brand {
      color: white !important;
      &:hover,
      &:focus {
        color: rgba(255, 255, 255, 0.8) !important;
      }
    }
    
    .nav li a {
      color: white !important;
      &:hover,
      &:focus {
        color: rgba(255, 255, 255, 0.8) !important;
      }
    }
    
    &.invert {
      .navbar-brand {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
      
      .nav li a {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
    }
  }
}

// Navigation styles for dark mode
.navbar-custom {
  .navbar-brand {
    color: var(--nav-text) !important;
    &:hover,
    &:focus {
      color: var(--nav-text-hover) !important;
    }
  }
  
  .nav li a {
    color: var(--nav-text) !important;
    &:hover,
    &:focus {
      color: var(--nav-text-hover) !important;
    }
  }
  
  &.invert {
    .navbar-brand {
      color: var(--nav-invert-text) !important;
      &:hover,
      &:focus {
        color: var(--nav-invert-text-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--nav-invert-text) !important;
      &:hover,
      &:focus {
        color: var(--nav-invert-text-hover) !important;
      }
    }
    
    .navbar-toggle .icon-bar {
      background-color: var(--nav-invert-text) !important;
    }
  }
  
  // Fixed navbar semi-transparent background
  &.is-fixed {
    background-color: fade(#ffffff, 90%) !important; // Light mode: 90% white
    border-bottom: 1px solid darken(#ffffff, 5%) !important;
    
    .navbar-brand {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

// Dark mode navbar fixed background override
[data-theme="dark"] .navbar-custom {
  &.is-fixed {
    background-color: fade(#2d2d2d, 90%) !important; // Dark mode: 90% dark background
    border-bottom: 1px solid lighten(#2d2d2d, 15%) !important; // Lighter border for dark mode
    
    .navbar-brand {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

// Search page dark mode
.search-page {
  background: var(--search-bg) !important;
  
  #search-input {
    color: var(--search-text) !important;
    background: var(--search-bg) !important;
  }
  
  .search-icon-close {
    color: var(--search-icon) !important;
  }
}

.search-icon a {
  color: var(--search-icon) !important;
}

// Post content dark mode
.post-container {
  background-color: var(--post-bg);
  color: var(--post-text);
  
  a {
    color: var(--post-link) !important;
    &:hover,
    &:focus {
      color: var(--post-link-hover) !important;
    }
  }
  
  h2::before {
    border-bottom-color: #ffffff !important;
  }
  
  h4, h5, h6 {
    color: var(--text-muted) !important;
  }
}

// Main content areas
a {
  color: var(--text-color) !important;
  &:hover,
  &:focus {
    color: var(--post-link-hover) !important;
  }
}

// Blockquotes
blockquote {
  color: var(--blockquote-color) !important;
}

// Tables
table.table > tbody,
table.table > thead {
  th, td {
    border-color: var(--table-border) !important;
  }
}

// Tags
#tag_cloud {
  a, .tag {
    background: var(--tag-bg) !important;
    color: var(--tag-text) !important;
    
    &:hover,
    &:active,
    &.focus {
      background-color: var(--tag-hover-bg) !important;
      color: #ffffff !important;
    }
  }
}

// Back to top button - Light mode: dark border, Dark mode: inverted
#back-top a {
  background-color: var(--back-top-bg) !important;
  border-color: var(--back-top-border) !important;
  color: var(--back-top-text) !important;
  transition: all 0.3s ease;
  
  &:hover,
  &:focus {
    background-color: var(--back-top-hover-bg) !important;
    border-color: var(--back-top-hover-border) !important;
    color: var(--back-top-hover-text) !important;
  }
}

#back-top a:hover i,
#back-top a:focus i {
  color: var(--back-top-hover-text) !important;
}

// Disqus dark mode support
#disqus_thread {
  background-color: var(--disqus-bg) !important;
  color: var(--disqus-text) !important;
}

// Post preview styles
.post-preview {
  > a {
    color: var(--text-color) !important;
    &:hover,
    &:focus {
      color: var(--post-link-hover) !important;
    }
  }
  
  > .post-meta {
    color: var(--text-muted) !important;
    > a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

.post-content-preview {
  color: var(--text-muted) !important;
  &:hover {
    color: var(--post-link-hover) !important;
  }
}

// Footer
footer .copyright a {
  color: var(--post-link) !important;
  &:hover,
  &:focus {
    color: var(--post-link-hover) !important;
  }
}

// Mobile navbar and layout fixes
@media only screen and (max-width: 767px) {
  
  .navbar-default .navbar-collapse {
    background: var(--bg-color) !important;
    border: 1px solid var(--border-color) !important;
  }
  
  // Fix mobile navbar colors for light mode
  .navbar-custom {
    .nav li a {
      color: var(--text-color) !important;
      &:hover,
      &:focus {
        color: var(--post-link-hover) !important;
      }
    }
    
    // Override invert class on mobile for light mode
    &.invert {
      .nav li a {
        color: var(--nav-invert-text) !important;
        &:hover,
        &:focus {
          color: var(--nav-invert-text-hover) !important;
        }
      }
    }
  }
  
  // Ensure theme toggle doesn't cause horizontal scroll
  .theme-toggle-li {
    overflow: hidden;
    
    .theme-toggle {
      max-width: 100%;
      overflow: hidden;
    }
  }
}

// Side catalog
.side-catalog {
  background-color: var(--bg-color);
  color: var(--text-color);
  
  h5 a {
    color: var(--text-color) !important;
    &:hover {
      color: var(--post-link-hover) !important;
    }
  }
  
  .catalog-body {
    li a {
      color: var(--text-color) !important;
      &:hover {
        color: var(--post-link-hover) !important;
      }
    }
  }
}

// Intro header text style - only apply to dark mode, let light mode use original styles
[data-theme="dark"] .intro-header.style-text {
  .site-heading,
  .post-heading,
  .page-heading {
    color: var(--text-color) !important;
  }
  
  .tags {
    a, .tag {
      border-color: var(--text-color) !important;
      color: var(--text-color) !important;
      &:hover,
      &:active {
        background-color: var(--tag-hover-bg) !important;
        color: #ffffff !important;
      }
    }
  }
}

// Pager (Previous/Next buttons) dark mode
.pager {
  li {
    > a,
    > span {
      background-color: var(--post-bg) !important;
      color: var(--text-color) !important;
    }
    
    > a:hover,
    > a:focus {
      background-color: var(--post-link-hover) !important;
      border-color: var(--post-link-hover) !important;
      color: #ffffff !important;
      
      > span {
        color: #ffffff !important;
      }
    }
  }
  
  .disabled {
    > a,
    > a:hover,
    > a:focus,
    > span {
      background-color: var(--tag-bg) !important;
      color: var(--text-muted) !important;
    }
  }
}

// For pages with header-img (background image), keep tags white in both light and dark modes
// This is controlled by the navbar-theme-excluded class added by dark-mode.js
body.navbar-theme-excluded {
  .intro-header:not(.style-text) {
    .tags {
      a, .tag {
        border-color: rgba(255, 255, 255, 0.8) !important;
        color: rgba(255, 255, 255, 1) !important;
        &:hover,
        &:active {
          color: white !important;
          border-color: white !important;
          background-color: rgba(255, 255, 255, 0.4) !important;
        }
      }
    }
  }
}